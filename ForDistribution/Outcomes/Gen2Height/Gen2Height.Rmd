# Calculating Gen2 Height
This sequence picks a single height value per Gen2 subject.

```{r SetOptions, echo=FALSE, cache=FALSE}
options(width=80)
opts_chunk$set(comment="", warning=FALSE, echo=TRUE, tidy=FALSE, size="small")
pathSourceCode <- file.path(getwd(), "Gen2Height.R")
read_chunk(pathSourceCode) #This allows knitr to call chunks tagged in the underlying PrototypeCode.R file.
pathOutputSubjectHeight <- file.path(getwd(), "Gen2Height.csv")
pathInputKellyOutcomes <- file.path(dirname(dirname(dirname(getwd()))), "OutsideData/KellyHeightWeightMath2012-03-09/ExtraOutcomes79FromKelly2012March.csv")
  #file.path(getwd(), "ExtraOutcomes79FromKelly2012March.csv")

# pathOutputSubjectHeight
# pathInputKellyOutcomes
# 
# getwd()
# dirname(getwd())
# dirname(dirname(getwd()))
# dirname(dirname(dirname(getwd())))
# file.path(dirname(dirname(dirname(getwd()))), "OutsideData/KellyHeightWeightMath2012-03-09/ExtraOutcomes79FromKelly2012March.csv")
```


```{r LoadPackages, echo=FALSE, message=FALSE}
```
### Define the age cutoffs to keep ages within the same Window as Gen1 Heights.  Define the height cutoffs to exclude values that are more likely to be entry errors or a developmental disorder, than a true reflection of additive genetics
```{r DefineBoundaries}
```

### Load the appropriate information from the SQL Server database
```{r LoadData}
```

### Combine the feet and inches to get total inches.  Filter out records with height values that are outside the desired range
```{r CalculateTotalInches, fig.height=2, cache=TRUE}
```

### Join the height data with age of the subject when the height was taken.  Filter out records where the age is outside of the desired window.
```{r JoinSubjectYearAndHeightYear, fig.height=5, cache=TRUE}
```
### Standardize by Gender & Age.  Calculated Age (using SurveyDate and MOB) has been truncated to integers.  
```{r Standarize, fig.height=2, cache=TRUE}
```

### Determine Z-score to clip at.  Adjust as necessary (zMin & zMax were defined at the top of the page).  The white box extends between zMin and zMax.
```{r DetermineZForClipping, fig.height=5, cache=TRUE}
```

### Pick the subject's oldest record (within that age window).  Then examine the age & Z values
```{r ReduceToOneRecordPerSubject, fig.width=4,fig.height=2.8, cache=TRUE} 
```

### Compare with Kelly's height values.  Make sure they roughly agree. There are a few differences, including (1) the age range is a little shifted, (2) the 2010 survey wasn't available, (3) the cutoff scores were more generous, and (4) the order of standardization & clipping *might* have been different.
```{r ComparingWithKelly, fig.width=9, fig.height=6, cache=TRUE, message=TRUE, echo=T } 
```
